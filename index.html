<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI vs. Human Essays</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
    body { font-family: Arial, sans-serif; background: #121212; color: #eee; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    .controls { text-align: center; margin-bottom: 20px; }
    button, input { margin: 5px; padding: 5px 10px; background: #333; color: white; border: none; border-radius: 4px; }
    button:hover, input:hover { background: #444; }
    .chart-container { display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; }
    svg { background: #1e1e1e; border-radius: 6px; padding: 10px; }
    .essay-list { margin-top: 30px; max-width: 800px; margin-left: auto; margin-right: auto; }
    .essay { padding: 10px; border-bottom: 1px solid #444; }
    .highlight { background: yellow; color: black; }
</style>
</head>
<body>

<div class="controls">
    <button onclick="setFilter('all')">Show All</button>
    <button onclick="setFilter('ai')">AI Only</button>
    <button onclick="setFilter('human')">Human Only</button>
    <input id="searchBox" type="text" placeholder="Search word..." oninput="updateDashboard()">
</div>

<div class="chart-container">
    <div>
        <h3>Average Word Count</h3>
        <svg id="wordCountChart" width="400" height="300"></svg>
    </div>
    <div>
        <h3>Average Sentence Length</h3>
        <svg id="sentenceLengthChart" width="400" height="300"></svg>
    </div>
    <div>
        <h3>Most Common Words</h3>
        <svg id="wordFreqChart" width="400" height="300"></svg>
    </div>
</div>

<div class="essay-list" id="essayList"></div>

<script>
let essays = [];
let currentFilter = "all";

d3.csv("AI Generated Essays Dataset.csv").then(data => {
    essays = data.map(d => ({
        text: d.text,
        generated: d.generated === "1",
        wordCount: d.text.split(/\s+/).filter(w => w).length,
        avgSentenceLength: calcAvgSentenceLength(d.text)
    }));
    updateDashboard();
});

function calcAvgSentenceLength(text) {
    let sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
    let words = text.split(/\s+/).filter(w => w);
    return sentences.length ? (words.length / sentences.length) : 0;
}

function setFilter(type) {
    currentFilter = type;
    updateDashboard();
}

function updateDashboard() {
    let searchTerm = document.getElementById("searchBox").value.toLowerCase();
    let filtered = essays.filter(e => {
        if (currentFilter === "ai") return e.generated;
        if (currentFilter === "human") return !e.generated;
        return true;
    });
    if (searchTerm) {
        filtered = filtered.filter(e => e.text.toLowerCase().includes(searchTerm));
    }
    drawWordCountChart(filtered);
    drawSentenceLengthChart(filtered);
    drawWordFreqChart(filtered);
    displayEssays(filtered, searchTerm);
}

function drawWordCountChart(data) {
    let avgAI = d3.mean(data.filter(e => e.generated), d => d.wordCount) || 0;
    let avgHuman = d3.mean(data.filter(e => !e.generated), d => d.wordCount) || 0;
    let chartData = [
        { label: "AI", value: avgAI },
        { label: "Human", value: avgHuman }
    ];
    drawBarChart("#wordCountChart", chartData, "Words");
}

function drawSentenceLengthChart(data) {
    let avgAI = d3.mean(data.filter(e => e.generated), d => d.avgSentenceLength) || 0;
    let avgHuman = d3.mean(data.filter(e => !e.generated), d => d.avgSentenceLength) || 0;
    let chartData = [
        { label: "AI", value: avgAI },
        { label: "Human", value: avgHuman }
    ];
    drawBarChart("#sentenceLengthChart", chartData, "Words per Sentence");
}

function drawWordFreqChart(data) {
    let wordCounts = {};
    data.forEach(e => {
        e.text.toLowerCase().split(/\W+/).forEach(w => {
            if (w.length > 3) wordCounts[w] = (wordCounts[w] || 0) + 1;
        });
    });
    let topWords = Object.entries(wordCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10)
        .map(([word, count]) => ({ label: word, value: count }));
    drawBarChart("#wordFreqChart", topWords, "Frequency");
}

function drawBarChart(selector, data, yLabel) {
    let svg = d3.select(selector);
    svg.selectAll("*").remove();
    let width = +svg.attr("width") - 50;
    let height = +svg.attr("height") - 50;
    let x = d3.scaleBand().domain(data.map(d => d.label)).range([0, width]).padding(0.3);
    let y = d3.scaleLinear().domain([0, d3.max(data, d => d.value) || 1]).nice().range([height, 0]);
    let g = svg.append("g").attr("transform", "translate(40,10)");
    g.append("g").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x)).selectAll("text").style("fill", "#eee");
    g.append("g").call(d3.axisLeft(y)).selectAll("text").style("fill", "#eee");
    g.selectAll(".bar").data(data).enter().append("rect")
        .attr("class", "bar")
        .attr("x", d => x(d.label))
        .attr("y", height)
        .attr("width", x.bandwidth())
        .attr("height", 0)
        .attr("fill", "#4db6ac")
        .transition().duration(800).ease(d3.easeCubicInOut)
        .attr("y", d => y(d.value))
        .attr("height", d => height - y(d.value));
    g.append("text")
        .attr("x", width / 2)
        .attr("y", height + 40)
        .attr("fill", "#eee")
        .attr("text-anchor", "middle")
        .text(yLabel);
}

function displayEssays(data, searchTerm) {
    let container = document.getElementById("essayList");
    container.innerHTML = "";
    data.forEach(e => {
        let highlighted = e.text;
        if (searchTerm) {
            let regex = new RegExp(`(${searchTerm})`, "gi");
            highlighted = highlighted.replace(regex, '<span class="highlight">$1</span>');
        }
        container.innerHTML += `<div class="essay"><strong>${e.generated ? "AI" : "Human"}</strong><br>${highlighted}</div>`;
    });
}
</script>
</body>
</html>
