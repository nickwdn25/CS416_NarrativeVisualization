<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI vs. Human Essays</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #1e1e1e;
        color: #f0f0f0;
        margin: 0;
        padding: 0;
        text-align: center;
    }
    h1 {
        margin-top: 20px;
        color: #ffcc66;
    }
    p {
        color: #ccc;
        max-width: 700px;
        margin: 0 auto 20px;
        line-height: 1.4em;
    }
    .controls {
        margin-bottom: 20px;
    }
    select, button, input {
        background: #333;
        color: #fff;
        border: 1px solid #555;
        padding: 6px 10px;
        margin: 5px;
        border-radius: 4px;
        cursor: pointer;
    }
    button.active {
        background: #ffcc66;
        color: #000;
        font-weight: bold;
    }
    svg {
        background-color: #262626;
        border-radius: 8px;
    }
    .tooltip {
        position: absolute;
        background: rgba(0, 0, 0, 0.85);
        color: #fff;
        padding: 6px 10px;
        font-size: 0.85em;
        border-radius: 4px;
        pointer-events: none;
        opacity: 0;
    }
</style>
</head>
<body>

<h1>AI vs. Human Essays</h1>
<p>Explore differences between AI-generated and human-written essays. Switch metrics, filter by type, and see which words dominate each style.</p>

<div class="controls">
    <label>Metric:</label>
    <select id="metric">
        <option value="score">Average Score</option>
        <option value="wordcount">Average Word Count</option>
        <option value="topwords">Top Words</option>
    </select>
    <label>Filter:</label>
    <button class="filter-btn active" data-filter="both">Both</button>
    <button class="filter-btn" data-filter="ai">AI Only</button>
    <button class="filter-btn" data-filter="human">Human Only</button>
    <input type="text" id="search" placeholder="Search word..." style="display:none;">
</div>

<div id="chart"></div>
<div class="tooltip" id="tooltip"></div>

<script>
// ====== CONFIG ======
const margin = { top: 40, right: 30, bottom: 50, left: 70 };
const width = 800 - margin.left - margin.right;
const height = 500 - margin.top - margin.bottom;

// Tooltip
const tooltip = d3.select("#tooltip");

// SVG
const svg = d3.select("#chart")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

// ====== LOAD DATA ======
d3.csv("AI Generated Essays Dataset.csv").then(rawData => {
    // Normalize
    rawData.forEach(d => {
        if (d.Type) d.Type = d.Type.trim();
        if (d["Average_Score"]) d.Average_Score = +d["Average_Score"];
        if (d["Average_Word_Count"]) d.Average_Word_Count = +d["Average_Word_Count"];
        if (d.Frequency) d.Frequency = +d.Frequency;
        if (d.Word) d.Word = d.Word.trim();
    });

    // Current state
    let metric = "score";
    let filter = "both";

    // Controls
    d3.select("#metric").on("change", e => {
        metric = e.target.value;
        d3.select("#search").style("display", metric === "topwords" ? "inline-block" : "none");
        updateChart();
    });
    d3.selectAll(".filter-btn").on("click", function() {
        d3.selectAll(".filter-btn").classed("active", false);
        d3.select(this).classed("active", true);
        filter = d3.select(this).attr("data-filter");
        updateChart();
    });
    d3.select("#search").on("input", updateChart);

    // Main update function
    function updateChart() {
        let data;
        if (metric === "score") {
            data = d3.rollups(rawData, v => d3.mean(v, d => d.Average_Score), d => d.Type)
                .map(([Type, value]) => ({ key: Type, value }));
        }
        else if (metric === "wordcount") {
            data = d3.rollups(rawData, v => d3.mean(v, d => d.Average_Word_Count), d => d.Type)
                .map(([Type, value]) => ({ key: Type, value }));
        }
        else if (metric === "topwords") {
            data = rawData.filter(d => d.Word && d.Frequency)
                .filter(d => {
                    if (filter === "ai") return d.Type === "AI";
                    if (filter === "human") return d.Type === "Human";
                    return true;
                });

            const searchTerm = d3.select("#search").property("value").toLowerCase();
            if (searchTerm) {
                data = data.filter(d => d.Word.toLowerCase().includes(searchTerm));
            }
            data = d3.rollups(data, v => d3.sum(v, d => d.Frequency), d => d.Word)
                .map(([word, value]) => ({ key: word, value }))
                .sort((a, b) => b.value - a.value)
                .slice(0, 10);
        }

        if (filter !== "both" && metric !== "topwords") {
            data = data.filter(d => {
                if (filter === "ai") return d.key === "AI";
                if (filter === "human") return d.key === "Human";
                return true;
            });
        }

        // Scales
        const x = d3.scaleBand()
            .domain(data.map(d => d.key))
            .range([0, width])
            .padding(0.3);

        const y = d3.scaleLinear()
            .domain([0, d3.max(data, d => d.value)]).nice()
            .range([height, 0]);

        // Axes
        svg.selectAll(".x-axis").remove();
        svg.selectAll(".y-axis").remove();
        svg.append("g")
            .attr("class", "x-axis")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x).tickSizeOuter(0));
        svg.append("g")
            .attr("class", "y-axis")
            .call(d3.axisLeft(y));

        // Bars
        const bars = svg.selectAll(".bar")
            .data(data, d => d.key);

        bars.join(
            enter => enter.append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.key))
                .attr("y", height)
                .attr("width", x.bandwidth())
                .attr("height", 0)
                .attr("fill", "#66ccff")
                .on("mousemove", (e, d) => {
                    tooltip.style("opacity", 1)
                        .html(`<strong>${d.key}</strong><br>${metricLabel(metric)}: ${d.value.toFixed(2)}`)
                        .style("left", (e.pageX + 10) + "px")
                        .style("top", (e.pageY - 28) + "px");
                })
                .on("mouseout", () => tooltip.style("opacity", 0))
                .transition().duration(800).ease(d3.easeCubicInOut)
                .attr("y", d => y(d.value))
                .attr("height", d => height - y(d.value)),
            update => update.transition().duration(800).ease(d3.easeCubicInOut)
                .attr("x", d => x(d.key))
                .attr("width", x.bandwidth())
                .attr("y", d => y(d.value))
                .attr("height", d => height - y(d.value)),
            exit => exit.transition().duration(500).attr("y", height).attr("height", 0).remove()
        );
    }

    function metricLabel(metric) {
        if (metric === "score") return "Average Score";
        if (metric === "wordcount") return "Average Word Count";
        return "Frequency";
    }

    updateChart();
});
</script>

</body>
</html>
